# 2.2 ACR에 있는 이미지로 Linux의 웹앱에 배포하기
2017년도부터 정식으로 Azure App Service 계획에서 Linux를 정식 지원하기 시작했습니다. 그와 함께 나온 것이 Linux의 웹앱이며, 기존 Windows 환경의 IIS를 Linux에서는 container로 구현해 놓았습니다. 따라서 Linux의 웹앱은 Docker 이미지를 기반으로 배포가 가능합니다.

기존 웹앱에서 플랫폼 Linux로 선택하는 것과 Linux의 웹앱은 동작방식은 같지만 사용자에게 제공하는 기본 이미지는 다릅니다. 기존 웹앱에서 플랫폼 Linux로 선택하는 것은 PHP나 JAVA등이 설치된 기본 Docker 이미지를 Microsoft에서 제공하는 것이며, Linux의 웹앱은 사용자가 Docker 이미지를 배포하여 구성하는 방식입니다.

여기서는 **Azure Container Registry**를 이용하여 Linux의 웹앱을 구성하도록 하겠습니다.

## Linux의 웹앱 구성하기
1. 1. [Azure 웹 콘솔](https://portal.azure.com)에 접속합니다.

2. 왼쪽 메뉴에서 **새로 만들기**를 선택합니다.

3. 블레이드에 **새로 만들기**창이 뜨면 윗쪽에 **검색창**에서 **웹앱**을 입력한 후 엔터를 입력합니다.

4. **웹앱 검색 결과**가 뜨면 **Linux의 웹앱**를 클릭합니다.

5. **Linux의 웹앱 만들기** 블레이드가 뜨면 아랫쪽에 **만들기**버튼을 클릭합니다.

6. **Linux의 웹앱 만들기** 블레이드가 뜨면 다음과 같이 정보를 입력한 후 아랫쪽에 **대시보드 고정**을 체크한 후 **만들기**버튼을 클릭합니다.
    - `앱 이름` : Linux의 웹앱이 표시될 이름을 입력합니다. 이 이름은 전 세계에서 유일해야 합니다.
    - `구독` : 컨테이너 레지스트리를 생성할 구독을 선택합니다.
    - `리소스 그룹` : **기존 그룹 사용**을 선택하신 후 드롭 다운 메뉴에서 이전에 생성한 리소스 그룹을 선택합니다.
    - `App Service 계획/위치` : App Service 계획을 설정합니다. App Service 계획 블레이드에서 새로 만들기를 클릭한 후 다음과 같이 정보를 입력합니다.
        - `App Service 계획` : App Service 계획이 표시 될 이괼 이름을 입력합니다.
        - `위치` : App Service 계획이 생성될 위치를 선택합니다. 이전에 생성한 리소스 그룹과 같은 위치를 선택합니다.
        - `가격 책정 계층` : App Service 계획의 성능을 선택합니다. 여기서는 S1 표준을 선택합니다.
    - `컨테이너 구성` : Linux의 웹앱에 배포할 Docker 이미지를 선택합니다. 다음과 같이 정보를 입력합니다.
        - `이미지 소스` : Linux의 웹앱에 배포할 이미지가 어디에 있는지를 설정합니다. 여기서는 **Azure Container Registry**를 선택합니다.
        - `레지스트리` : **Azure Container Registry**를 선택합니다.
        - `이미지` : Linux의 웹앱에 배포할 이미지를 선택합니다.
        - `태그` : Docker 이미지에 Tag를 지정했다면, 해당 태그를 선택합니다. 만약 Docker 이미지에 Tag를 지정하지 않았다면 Latest를 선택합니다.
        - `시작 파일` : *docker run* 명령에 사용되는 COMMAND를 입력합니다. 여기서는 공란으로 둡니다.

7. **Linux의 웹앱**이 배포가 완료되면, 오른쪽 **URL**에 있는 주소로 접근하여 Wordpress가 정상적으로 뜨는지 확인합니다. 첫 페이지가 뜨는데 까지 시간이 오래 걸릴 수 있습니다.

## 연속 배포 설정하기
8. 왼쪽 네비게이터에서 **응용 프로그램 설정**을 클릭합니다.

9. 오른쪽에 설정창이 뜨면 **응용 프로그램 설정**부분에 **새 설정 추가**를 클릭하고 다음과 같이 입력하고 윗쪽에 **저장**을 클릭합니다.
    - `이름 입력` : DOCKER_ENABLE_CI 를 입력합니다.
    - `값 입력` : true 를 입력합니다.
    - `슬롯 설정` : 체크하지 않습니다.

    > [!메모]
    > 
    > **일반 설정**에 **항상**옵션이 켜져있으면 웹앱에 요청이 없더라도 Conrainer가 계속 떠 있어 반응속도를 올릴 수 있습니다.

10. 왼쪽 네비게이터에서 **Docker 컨테이너**를 클릭합니다.

11. **연속 배포**부분에 **설정**으로 되어있는 것을 확인하고 **저장**을 클릭합니다.